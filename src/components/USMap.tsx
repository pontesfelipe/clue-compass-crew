import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useStateScores } from "@/hooks/useStateData";
import { Skeleton } from "@/components/ui/skeleton";

const getScoreColor = (score: number): string => {
  if (score >= 80) return "#22c55e";
  if (score >= 70) return "#84cc16";
  if (score >= 60) return "#eab308";
  if (score >= 50) return "#f97316";
  return "#ef4444";
};

// Accurate US state paths - properly positioned
const statePaths: Record<string, { d: string; name: string }> = {
  HI: { d: "M233 519l3 4-2 3-4-1-2-3 2-3h3zm12 6l5 4 1 4-3 4h-6l-3-2-1-5 2-3 5-2zm22 10l5 5 1 3-4 3-1 4-3 1-4-1-1-3v-3l1-5 6-4zm15 12l6 5-2 4-6-1-3-1v-4l5-3zm21 14l3 6 6 3 4 5-2 6-6 1-7-2-5-4-1-7 1-5 7-3z", name: "Hawaii" },
  AK: { d: "M158 482l-3-2 7-5 3-1 4 3 5 1 5-1 1-3 5-5 2-1 1-3 5-4 5-1 4-2 4 1 6-2 2-2 3-1 2-1 1-3 2-4 5 1 6 1 5-4 3 1 3-3 4-1 4 2 5-1 2 2 4-4 4-1 2-2 3 1 2 1 3 1 5 1 5-1 2 4 3 3 1 2-1 4-4 5-5 4-1 2 1 5 2 3-1 4-1 2-5 4-4 5-2 4-1 4-4 5 1 3 4 2 1 2-3 5-5 5-5 2-9 1-8 1-6 2-7 3-5 5-4 4-7 3-4 2-6 1-8 4-5 1-9 2-4-1-5 1-7-1-6-3-6 1-3 1-4-3-6-5-9-5-6-4-4-5 1-2-5-5-7-4-7-2-6-2-2-1 2-4 6-2 2-1-1-3-5-3-1-4 5-2 5-3 1-4-3 3z", name: "Alaska" },
  FL: { d: "M760 439l3 5 8 9 4 8 2 7 5 7 6 7 3 9 6 12 2 5 5 8-1 4 3 4v3l-5-1-3 3-4 1-2-1-2 3h-2l-3 3-7-1-2-2-3 3-3-3v-4l-5-2-5-3-4-2-3-5-6-5-3-8-6-7-5-5-3-4-6-1-6-3-5-4-5-2-1-4-9-2-8-3-5-3-5-4-2-8-6-4-2-3-6-1-6-5-1-7-3-4-9-3-3 1-3-2 4-6-4-2 1-2h-5l-6 6-1 5-6 1-5 5-7 3-1-3v-4l-6-4-7 2-7 1-7 2-3 3-8-1-4 2-9-1-5 3-4 4-8-1-3-1 3-6-1-9 5-3-2-5-1-5 7-2 47-6 19-3 5 5 8 9 4 11 7 8 2 7 5 3-1 8 6 12 6 8 4 9 7 7 3 8 4 6-1 12-5 4 2 7 1 7 4 7-1 9-3 3 4 8 2 10 5 8 1 4z", name: "Florida" },
  SC: { d: "M717 360l6 14 3 17-5 3-3 8-7 2-6 8-5 6-1 5-6 8-7 8-3 1-1 4-4 4-2-1-8 1-5 2-2-3-6-6-7-2-4-6-7-4-4-1-4-5-8-4-6 2-6-2 3-4-1-8-6-5-1-4-4-7-7-5 1-3-9-7-3-5 2-3 12 1 30-1 38-1 28-2 7 15z", name: "South Carolina" },
  GA: { d: "M670 337l4 6 38-4 7 15 6 14 3 17-5 3-3 8-7 2-6 8-5 6-1 5-6 8-7 8-3 1-1 4-4 4-2-1-8 1-5 2-47 6-7 2 1 5 2 5-5 3 1 9-3 6 3 1-4-48-1-12-6-45z", name: "Georgia" },
  AL: { d: "M615 339l39-4 4 42 6 48-3 9 5 9-3 10v7l8 10-7 6-2 1 4 14-19 3-48 6 1-12 4-48 6-45z", name: "Alabama" },
  NC: { d: "M824 316l3 8 4 8 5-1 1 6-4 1-1 6-3-1-1-1-6-1-9 3-1-3-6 5-8 6-8 11-3 1-1 3 3 2-3 9-5 1-6 1-6-3-1 5-21 2-20 1-28 1-30-1-12-1-2-3 7-8 7-4 5-1 19-4 14-1 8-4 10-2 5-4 8-2 6 1 5-7 8 1 6-2 3 1 8-5 8-2 6-3 7v-4l8-1 5-4 9-7 5-2 2-4 6 1 1-1 7 1 38-6 35-5z", name: "North Carolina" },
  TN: { d: "M699 321l-2 7-31 3-23 3-12 1-43 4-5 1-24 2-37 4v-1l-2-4-9-1-1-3-9-1-4-5-3-3 2-6 13-6 7 1 8-6 8 5 13 1 9-8 12 1 6-7 8-2 2-6 7-4-2-5 6-7v-7l10-5 4-4 4 1 3-4 21-2 14-2 10-1 5 5 3 5-1 6 15 1 7 35z", name: "Tennessee" },
  RI: { d: "M852 175l-2-10-4-1-1-7 8-3 4 7 4 6v4l-3 5-6-1z", name: "Rhode Island" },
  CT: { d: "M842 166l1 14-1 12-23 5-9 2-1-4 2-9-3-5 5-5 6-4 2-7 8-2 13-2z", name: "Connecticut" },
  MA: { d: "M882 146l2-5-2-4 1-2 4-1 5 6 1 4-11 2zm-23 1l5 2 2-1 2 1 2-3-3-1h-4l-5-2-2 2 3 2zm-17 22l1-8 4-4 4 1 3-2 9 1 16-6 6-8 5-2 3 4-4 4-1 3 4-1 1 4-3 1 2 4 6-4 2-5 3 1 3 5 5 1 6 5 7 2 4-1 4-4-2-2-4-1-8-5-1-5 1-1 5 4 6 2 5 1 5 3 4 4 2-1 1 3-3 3-7-1-12-1-21 4-4 3-4-1-1-5 1-2-1-1-5 4-2 5-9 2-6 3-6-1-6 1-1 4-8 1-2-2z", name: "Massachusetts" },
  ME: { d: "M868 52l4 2 3 1 5 7 7 5 2 3 5 5 7-1 4 10-3 1 5 4-2 4 4 3-2 4 3 5-3 2-3-4-4 2 1 4-2 2 1 6-5 4 3 8-5 1-4 2-1 5-5-1-2-4-2 2-2 4-2-2 1-5-3 1 2-7 2-8 3-5-1-3 4-4 5-2 2-4-2-4 3-6-3-16-2-5-1-6-4-9 7-3 5-1 1-2 7-5 5-1 3 3 8 2 2-2-1-5 5 1 4-5 1-5 2-8-5-10 1-4-1-8 3 1 8 6 7 1 10 5 8 5z", name: "Maine" },
  NH: { d: "M846 71l1 5 3 6-2 7-4-8v-9l-6-3-1-8 1-5-1-5 6-2 9-9 4-2-1 4 5 10-2 8-1 5-4 5 5 1-1 5 3 4-1 5 4 7-4 8 1 4 1 3 5 2 2 8-1 5-4 9 1 7-4-1-2 2-8-1 1-8-4-4 2-5 4-1-1 5 4-1 2-4-1-9 5-4-1-6 2-2-1-4 4-2-3-4 2-4-5-4 3-1-4-10z", name: "New Hampshire" },
  VT: { d: "M817 80l3 1 4 7 1 9-2 4 4 1 2 4-1 9-5 4 1 6-4 4 2 8 1 3 8 1 2-2 4 1-1-7 4-9-2-8-5-2-1-3-1-4 4-8-4-7 1-5-3-4 1-5-5-1 4-5 1-5 2-8-5-10-23 6-4 21 26-1z", name: "Vermont" },
  NY: { d: "M824 135l2 2 6-4 4-3 8-1 9-3 9-4 4-3 3 1 3 4 1 3-1 3-3 2-4 4-6 4-3 6-3 3h-7l-5 3-4 6-3 3-3-1-4-4-5-2-7 2-9 5-6 7-5 9-4 11-2 9v3l23-5 1-12 5-1 3 4 7-5 5-3 8-1 9-4 5 4 5 1 6-6 3 1 6 15 7 8-6 5-8 9-6 4-3 1-3-1-6-4-5-2-7 1-11 2-7 3-9 2 1-3 4-2 1-4-3-4-5-3-1-2 1-2 8 1 6-2 9-7 4-5 5-7 1-3 1-7-2 1-52 12-15 3-2-10-1-10-3-4-4-7-4-7v-5l5-3 1-4 6-5 5-3 6-2 3-5 7-6 1-5-7-6-3-8-5-8 4-4 10-5 10-3 7 1 5 4 5 1 6-5 8-2 10-1 4-3 4-8 7-2z", name: "New York" },
  NJ: { d: "M801 178l1 4 6 3 3 6 5 9-2 5 3 5 5 4 3 7 5 5 4 1 3-4 1-5-3-3 1-2 1-6-2-5-1-4-3-1-1-5 5-7 2-5 1-7-3-3-4 1-1 3-2 5-5 2-15 3 2 10z", name: "New Jersey" },
  PA: { d: "M786 181l-52 11-15 3-54 10-9 2 3 5-1 7 4 5 3 8v7l5 8v8l4 6v5l58-11 12-3 22-5 16-3 2-5-3-5 2-5-5-9-3-6-6-3-1-4 15-3 5-2 2-5 1-3 4-1 3-3z", name: "Pennsylvania" },
  DE: { d: "M789 222l3 3 5 5 3 14 4 13 2 5-4 1-10-1-3 2h-5l1-9-1-6 4-8-3-8 4-11z", name: "Delaware" },
  MD: { d: "M789 222l-4 11 3 8-4 8 1 6-1 9h5l3-2 10 1 4-1-2-5-4-13-3-14-5-5-3-3zm-12 43l-58 12-1 3 2 7-2 7 6 7 4-2 1-6 5 2 4 9 5-1 5-4 4 1 5-4 5 1 5-5 3-1 4 5h5l5-5 4 2 5-1 2-5 3 1v-5l-3-5 1-3-5-1v5l-5 1-5 1-7-3-1-5 3-2-3-5z", name: "Maryland" },
  VA: { d: "M768 254l7 14-4 4-3 4-1 6-5 4-4-1-5 4-5 1-4-9-5-2-1 6-4 2-6-7 2-7-2-7 1-3 58-12-3 5v5l5 1-3 3 1 5 7 3 5-1 5-1v-5l5 1 3 5v5l-2 5-5 1-4-2h-5l-5 5-5-1-5 4-4-1-5 4-5 1-4-9-5-2-1 6-4 2-5 5-3 6-4 3-1 6 38-6 35-5 2-3 5-3 5 2 5 2 2 4-5 3 3 3 2 5-2 3-4 2-3 6 3 7-2 3-7-8-6-3-1 4-6-1-2 4-5 2-9 7-5 4-8 1v4l-7 1-6 3-8 2-8 5-3-1-6 2-8-1-5 7-6-1-8 2-5 4-8-2-3-1-23 4-3-7 7-8 7-4 5-1 19-4 14-1 8-4 10-2 5-4 8-2 6 1 5-7 8 1 6-2 3 1 8-5 8-2 6-3 7v-4l8-1 5-4 9-7 5-2 2-4 6 1v-1z", name: "Virginia" },
  WV: { d: "M719 265l-1-3-6-3-6-6-5-2-5 4-6-4-9-1v-1l-2-4-9-1-1-3-9-1-4-5-3-3 2-6 9-2 3-5v-8l-5-8v-7l-3-8-4-5 1-7-3-5 16-3 5 35 3 5 6 5 7-9 1-4-3-8 5-3 4-6 5-5 2-8 5-2-2-6 5 3 4 7 3 8 3 3 1 6-1 6 3 7 1 5-4 7 6 4 2 5-7 8 2 4 4 1 4 6z", name: "West Virginia" },
  OH: { d: "M669 199l3 4 7 5 1 8 10 1 4 4 1 4 7 8-2 7 4 5v4l4 3 8 6 3 5-1 3 5 6 1 6-5 3-12 2-8 7-7 5-3 6-7 1-4-1-1-4-6-1-5-5-7 7-6-1-4 4-4-5-6 1-5-5-3 4-4 3-4-7-4-5-5-3v-8l-4-5-4-6-2-6 4-3-2-5v-4l-6-8-2-6-7-10-4-8-2-5 10-2 19-3 11-2 9-1 21-4 24-5z", name: "Ohio" },
  IN: { d: "M618 204l4 6 7 10 2 6 6 8v4l2 5-4 3 2 6 4 6 4 5v8l5 3 4 5 4 7-3-4-4-3 3-4 5 5-6-1 4-4 6 1 7-7 5 5 6 1 1 4 4 1 7-1 3-6 7-5 8-7 12-2 5-3-1-6-5-6 1-3-3-5-8-6-4-3v-4l-4-5 2-7-7-8-1-4-4-4-10-1-1-8-7-5-3-4-9 1-37 5z", name: "Indiana" },
  IL: { d: "M581 187l3 3-2 5 3 6 1 5-1 9-1 14 1 7-4 6-2 6 5 11 5 8v10l4 13-1 7-4 4v6l4 6 14 13 10 4 1 5-3 3-1 5 4 5 6 1 4 8 1 8 2 3-4-7-4-5-5-3v-8l-4-5-4-6-2-6 4-3-2-5v-4l-6-8-2-6-7-10-4-8-2-5-10-2-4-4-11 2-4 4h-7l-4-4-6-5-4 4-7-1-7-8-6-1-7 4-7-2h-5l4-14 1-8-1-5 5-8 1-11-1-8 6-5 8-6-1-6-5-8 1-5-6-6 11-1 12-1 23-2z", name: "Illinois" },
  MI: { d: "M558 91l5-1 5-4 9-1 3 3 1 3 1 1 7-2 2-3 10-4 4 1 1 1-4 4-7 3-6 4-1 3-5 1-5 4-8 2-1-3-4-2-1-4-4-3 3 1zm108 67l-4 4-4 7-2 6 1 5-2 6-4 6 3 2 1 7-1 2 2 4-1 3-3-2-1 4-3 1 1 7 2 1 1 3-3 2-2 4 1 3-5 4-5 1-1-3 3-3 1-7 2-1-1-10-5-8-4-4-3 1-7 3-4 3-3 1-1-2-7 3-2 4-16 4-5 3-10 3-3 3-1 4-5 1-4 2-4 1-17 5 1-5 5-7 3-5-1-1-5 3-3-1-2-7 2-1 1-7 3-1 7-5 1-4-1-7-4-2-4-3-4-7-6-6-6-3 1-7 2-7-1-2 4-1 1-4 2-4-1-2 2-5 5-5-1-2 1-5 2 1 4-8 7-1 8-3 16-3 7 1 5 2 5-1 10 1 2 2 7 1 5-2 1-4 4-1 4 1 1 2-5 8-2 3 1 3-5 4 1 5 5 5 1 6-2 5 1 3-1 4 4 7 4 5 4 4 5 3 4 2 4-3 3 1 2 4-1 5 6 6 2 1 4-3 3 1 3 9-1 8-2 4 1 4-2 6-4 6 3 2 1 7-1 2z", name: "Michigan" },
  WI: { d: "M561 92l1-4 4-2 1-5 5-2-1-4 8-4 2-3 1-5 4-6 2 1 5-2 8 3 6 5 5 1 1 3 6 1 4-1 3 4 4-5 4-1 1-4 4-2v-5l3-1 3 5 5 5 3 1v4l5 1 2 5-1 4 6 5 2 7 3 1 1 4 4 4 5 3-1 3 5 7-4-1-7 1-8 3-16 3-1 4-7 5-3 1-1 7-2 1 2 7 3 1 5-3 1 1-3 5-5 7-1 5 17-5 4-1 4-2 5-1 1-4 3-3 10-3 5-3 16-4 2-4 7-3 1 2 3-1 4-3 7-3 3-1 4 4 5 8 1 10-2 1-1 7-3 3-1 3 5 1-5 4-1 7 2 1-1 3-2-4-3-2-1-3-4 6-4 7 1 2-4 4-4-1-2 6-4 6-3-1-1 7v3l2 1 2 4-3 4 1 4-3 6 1 5-5 1-10-3-7 6-8-1-3 3-10 1-2 2-8-1-2-2-3-4h-5l-7-4h-5v-5l-1-4h-4l-2 4-8-2-3-6-3-5 1-8-6-5-5-4 1-5 2-2v-4l-4-4 1-8-6-4 2-4 2-6-4-10-3-10-7-3-7-2-1-4-4-7-1-10 3-4 6-2z", name: "Wisconsin" },
  MO: { d: "M564 289l1 5 3-5 6-1 4 5-3-4-4-3 3-4 5 5-6-1 4-4 6 1 7-7 5 5 6 1 1 4 4 1 7-1 3-6 7-5 8-7 4-5 3-5 8-1 14-2 11-2 8-4 6-3 9-4 5-4 3-4 5 4 9 1 1 3 9 1 2 4v1l-4 6-3 3-4-1 2 6-5 2-2 8-5 5-4 6-5 3 3 8-1 4-7 9-6 5-7-9-6-5-3-5-5-35 1-4-4 8-4 3-10 1-6 5-8 2-10 5v4l-7 1-6 2 3 5 2 5-7 4-2 6-6 7-8 2-12-1-9 8-13-1-8-5-7 1-13 6-2 6 3 3 4 5 9 1 1 3 9 1 2 4v1l-3 9-5 6 1 6-6 3-10 9-4 8-5 5 1 4 7 5 3 10v15l-3 7-1 5 5 5 3 12-1 4-7-1-71 3-31 1-7-37-1-37 7-10 9-4-1-6-9-5-2-5 1-28-1-9-2-18-3-5-7-9 9-1z", name: "Missouri" },
  IA: { d: "M541 180l2 3-2 5 3 6 1 5-1 9-1 14 1 7-4 6-2 6 5 11 1 6-9 1 7 9 3 5 2 18 1 9-1 28 2 5 9 5 1 6-9 4-7 10 1 37-7-1-100 4 2-6-4-7-1-7-9-7-3-9 9-8-2-6 1-8-5-8 4-9 1-15-3-4-5-9 2-5-5-7 1-4-4-8-5 3-5-9 1-2 96-5 12-1z", name: "Iowa" },
  MN: { d: "M540 53l-1-10 36-1 1-14 1-1 40 1 2 11 4 3 7-1 1 3 8 1 1 10 4 3 1-1 7 1 2 3 7 5 2 7 4 4 4 1 4 3 1 14 5 3 4 1 1 9-7 4-6 8 1 9 2 2 8 1 1 6-1 11-1 8v5l-96 5-1 2 5-3 4 8-1 4 5 7-2 5 3 4 5 9 1 15-4 9 5 8-1 8 2 6-9 8 3 9 9 7 1 7 4 7-2 6-12 1-11 1-6-6-5 8-1 6-4-4-2-5-8-6-8 2-2 4-4-4-4 4-1-3-4-1-4-7-6-5-9-2h-6l-1-3-8-2-1-15-1-5-4-7-1-9-4-5-2-11-2-14-1-6 3-1 1-11-6-8-1-4-2-1-1-11z", name: "Minnesota" },
  OK: { d: "M396 336l-3 1-4-3-6-1-2-4-6-3-4-4-5 2 1 6-5-2-3 5 1 4-3 2 1 5-5 1-4-5-4 4-1 4-3-3-1-5-5-2-3 3-7 2-1-4-6-3-5 3-4-1-1-4-4-1-4 3-4-1-7-4-5-1-4 1-2-4-7 2-2-1-3 3-4-4-6-1-2 2 2 4 9 5 1 5-6 4-5 7 1 5 7 8 3 11v15l-3 7-1 5 5 5 3 12 27 1 77-3 31-1 1-67 1-34-43 2-42 2-1-18z", name: "Oklahoma" },
  KS: { d: "M497 277l-1 18 42-2 43-2-1 34-1 67 71-3 7 37-7 1-100 4 2-6-4-7-1-7-9-7-3-9 9-8-2-6 1-8-5-8 4-9 1-15-3-4-5-9 2-5-5-7 1-4-4-8-1-5-88 5z", name: "Kansas" },
  NE: { d: "M393 203l8 10 11 10 4 11-4 6 3 8-3 7 1 9 5 7-2 7 1 5-88 5-42-3-41-4 6-37 3-25 82 7 56 3z", name: "Nebraska" },
  SD: { d: "M419 121l84 5 5 5 5 1-2 7-1 10-4 9-2 9 6 3-3 7 4 5 7 10 4 2-56-3-82-7 3-16 3-25 4-3 5 4 5-2 3-6 5-2 7-2 5 3z", name: "South Dakota" },
  ND: { d: "M503 50l-1 10 2 1 1 4 6 8-1 11-3 1 1 6 4 5 2 11 4 9 1 5-84-5 3-30 2-35 70 4z", name: "North Dakota" },
  WY: { d: "M340 122l-6 75-89-8-3 37-41-4 6-37 3-25 4-3 5 4 5-2 3-6 5-2 7-2 5 3 9-83 92 10z", name: "Wyoming" },
  MT: { d: "M340 29l-9 83-5-3-7 2-5 2-3 6-5 2-5-4-4 3-3 25-6 37-41-4-3 1-20-3-24-4-15-3 6-35 4-17-4-7 1-4-5-3 2-3-3-10-5-4-4-8 3-11-4-7 3-12 6-16 7 1 3 5 4-1 4-4 8 2 2 3 5 1 4 5 7 6-1 7 8 11 2 2 1 4 8 4 4 3 1 1 4-6 1-5-3-8 2-7 4 1 2 4 4 1-1 5 4 1 1 4 7 10 3 1 37 4 37 3z", name: "Montana" },
  CO: { d: "M340 215l-89-8-3 37-6 75 90 6 87 3 6-75-85-5z", name: "Colorado" },
  ID: { d: "M227 34l-6 35-4 17 4 7-1 4 5 3-2 3 3 10 5 4 4 8-3 11 4 7-3 12-6 16-7-1-3-5-4 1-4 4-8-2-2-3-5-1-4-5-7-6 1-7-8-11-2-2-1-4-8-4-4-3-11 1-4-3 3-8 6 2 5-2 5-8-1-6 7-12 5-5-1-7-5-8-8-11 2-8-3-9 4-5-2-5 5-8 3-11 5-9-6-27 80 17z", name: "Idaho" },
  UT: { d: "M242 139l-15-3-6-27-39-8 14-77 52 10-3 49 3 1-6 55z", name: "Utah" },
  AZ: { d: "M193 242l-1 3-2 4 1 3 5 4 2 7-3 7-3 3-1 2 1 2-1 1-6 1-4 5-3 8-1 12-1 4 4 1 7 4 3 1 2 3 8 1 3 3-1 7-2 2 1 2-1 4-1 2-56-10-43-8 22-111 72 14z", name: "Arizona" },
  NV: { d: "M178 105l-22 111-15-2-30-72 11-55 80 17-24 1z", name: "Nevada" },
  OR: { d: "M178 29l-67 13-7-3-4 4-5-1-10 3-9-1-4 3-9-4-5-1-3 5-8 3 1 12-2 5 2 8-1 8-5 10-1 6 5 10-11 55 17 4 32 7 27 5 24-1 6 27 15 3 11-1 4 3 8 11 5 8 1 7-5 5-7 12 1 6-5 8-5 2-6-2-3 8-4 5-6-35-28-5v-81l-10-33 4-51 7-3-3-5 3-7z", name: "Oregon" },
  WA: { d: "M178 29l7 3 3 7-3 7-4 51 10 33v81l28 5-27-5-32-7-17-4-30-72 11-55-5-10 1-6 5-10 1-8-2-8 2-5-1-12 8-3 3-5 5 1 9 4 4-3 9 1 10-3 5 1 4-4 7 3 1-6 67-13z", name: "Washington" },
  CA: { d: "M111 87l30 72 15 2-72-14-4-1-7-6-4-3-8-12-5-3-3-10-4-3 2-5-5-7-3-7 3-8-3-7-1-10-4-6-1-10 5-8 2-9-3-6 3-5-1-5 4-6 7-10 3-12-4-8-4-11 3-1 5 7 3 8 1 6 4 10 4 5 3 10 3 3 1 6 5 7 2 8 28 5 5 35zm-37 154l-5 3-2-2-1-5 3-2 3-1 3 2-1 5zm-4 5l1 4-2 3-4-3-1-3 2-3 4 2zm-16-15l3 6 4 2 2 5-2 3-4-2-4-5-2-8 3-1z", name: "California" },
  NM: { d: "M332 328l-90-6 6-75 89 8-3 37-6 75 56 10 1-2 1-4-3-3-8-1-2-3-3-1-7-4-4-1 1-4 1-12 3-8 4-5 6-1 1-1-1-2 1-2 3-3 3-7-2-7-5-4-1-3 2-4 1-3-72-14z", name: "New Mexico" },
  TX: { d: "M494 428l3 48-1 21 4 21 3 5 1 6 3 1-1 4-3 3 1 1-4 7-2 10-1 7 1 5 6 7 2 8 5 5-1 6-3 3-5 14-1 7 1 3-2 8v5l-3 8-12-6-13-4-4-3-7-1-9 4-8 4-2 3-5 3-6 2-3 4-4 1-6 6-6 2-10-4-9-1-1-3-4-3 1-4-5-5-9-3-9-8-3-4 1-4-5-8-10-3-9-7-4-2-1-3-5-4-2-4-5-2-10-9-2-2v-4l-2-3-7-3-11-9-1-2-7-3-5-6-7-4-1-2-5-1-7 2-7-1-4-4-6-1-4-2-2-5-5-1-2-4-6-2-1-5-4-4 1-3-5-5-1-6-3-4-1-7-4-4-1-8-4-4-3-12-5-5 1-5 3-7v-15l-3-11-7-8-1-5 6-7 5-4-1-5-9-5-2-4 6 1 4 4 3-3 2 1 7-2 2 4 4-1 5 1 7 4 4-3 4 1 1 4 5-3 6 3 1 4 7-2 3-3 5 2 1 5 3 3 1-4 4-4 5-1 4 5-1-5 3-2-1-4 3-5 5 2-1-6 5-2 4 4 6 3 2 4 6 1 4 3 3-1 27-1 77-3 31-1 7 37z", name: "Texas" },
  LA: { d: "M565 424l-1 12-6 6-1 10 4 4 10 3-2 8-5 2-4 7 3 7 11 6-2 4-4 3 3 8-1 4 4 3-1 4-6 1-5-4-3 1-1 3 6 2 3 6-1 2-6-1-7 6-2 5 4 3-3 3h-3l1 3-4 1-4 5-1-3-3 1 1 3-5 2-3-3-3 3 3 4-3 4-5-1 1-4-4 1-1-2 4-3-1-4 5-3 2-3-3-4 5-3 1-4-5-3 4-4-3-4-8 4-3-5-3-2 3-5-2-4-8-1-6 2-3-2-4 3-5-2-8 3-3-4-6 3-6 1-4-1-1-5-9-1 2-8-9-11-3 1-6 5-2 1 2-11-3-9 5-7 7-1-3-13-2-7 3-6-3-4-4-2 2-6-3-7 1-5 5-1 6-5 6-6 5-3 3-10-1-7 2-5-2-5-11 1 3 6v5l-3 3 2 8-1 11-5 13-5 3-1 3 5 5 2-4 7-2 3-5 8-1 6 1 1 4v10l-3 3 5 5v4l-5 2-7 7 2 5 6 2 3 5 5 1 1 3 3-1 4 3 11 4 4-2 6 2 2 4 7 1 3-2 6 1 1 3 5 2-1 3-5 2-2 3-5 1-1 3 2 3-1 3 4 3 6-3 4-4 5-3 3 1 3 3-4 2-2 4 3 2 4-2 5 1v4l-3 4z", name: "Louisiana" },
  MS: { d: "M596 338l3 9-6 45-4 48 1 12-3-6-6-2-1-3-5-1-3-5-6-2-2-5v-4l-5-5 3-3v-10l-1-4-6-1-8 1-3 5-7 2-2 4-5-5 1-3 5-3 5-13 1-11-2-8 3-3v-5l-3-6 11-1 2 5-2 5 1 7 3 4-3 6 2 7 3 13-7 1-5 7 3 9-2 11 6-5 3-1 9 11-2 8 9 1 1 5 4 1 6-1 6-3 3 4 8-3 5 2 4-3 3 2 6-2 8 1 2 4-3 5 3 2 3 5 8-4 3 4-4 4 5 3-1 4-5 3 3 4-2 3-5 3 1 4-4 3 1 2 4-1-1 4 5 1 3-4-3-4 3-3 5 2-1-3 3-1 1 3 4-5 4-1-1-3h3l3-3-4-3 1-4-3-8 4-3 2-4-11-6-3-7 4-7 5-2 2-8-10-3-4-4 1-10 6-6 1-12 4-48z", name: "Mississippi" },
  AR: { d: "M555 292l-1 11-3 8 4 7-3 7 3 5 2 7-8 1-2 4 2 6 4 2 3 4-2 6-3 7 3 4-7 1-3 13 1 5-6 3-5 5-3-9 6-45-3-9-39 4-5-1-24-2-37-4 3-9v-1l-2-4-9-1-1-3-9-1-4-5-3-3 2-6 13-6 7 1 8-6 8 5 13 1 9-8 12 1 6-7 8-2 2-6 7-4 1 6-5 8 1 6 71-3z", name: "Arkansas" },
  KY: { d: "M702 285l-7 8 2 4 4 1 4 6 6 4-5 2-2 8 5 5-4 6 5 3 4-3 3-6 7-5 8-7 12-2 1 3 6 3 6 6 5 2 5-4 6 4 9 1v1l-9 4-6 3-8 4-11 2-14 2-8 1-3 5-4 5-8 7-12 2-5 3 1 6 5 6-1 3 3 5 8 6 4 3v4l4 5-2 7 7 8 1 4-7 9-6 5 6 5 5 35-16 3-9 2-21 2-14 2-10 1-4 1-21 2-31-3-23-3-12-1 3-8 5-6v-1l-3-12 5-5-1-5 3-7v-15l3-10-7-5-1-4 5-5 4-8 10-9 6-3-1-6 5-6 3-9 43-4 5-1 24-2 37-4z", name: "Kentucky" },
  AR2: { d: "M0 0z", name: "" },
};

const USMap = () => {
  const [hoveredState, setHoveredState] = useState<string | null>(null);
  const navigate = useNavigate();
  const { data: stateScores, isLoading } = useStateScores();

  const handleStateClick = (stateCode: string) => {
    navigate(`/state/${stateCode}`);
  };

  if (isLoading) {
    return (
      <div className="w-full aspect-[1.6/1] flex items-center justify-center">
        <Skeleton className="w-full h-full rounded-2xl" />
      </div>
    );
  }

  return (
    <div className="relative w-full">
      <svg
        viewBox="0 0 960 600"
        className="w-full h-auto"
        style={{ maxHeight: '550px' }}
      >
        <defs>
          <linearGradient id="mapBg" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="hsl(210, 20%, 98%)" />
            <stop offset="100%" stopColor="hsl(210, 25%, 95%)" />
          </linearGradient>
          <filter id="stateShadow" x="-5%" y="-5%" width="110%" height="110%">
            <feDropShadow dx="0" dy="1" stdDeviation="1" floodOpacity="0.1" />
          </filter>
          <filter id="stateHover" x="-10%" y="-10%" width="120%" height="120%">
            <feDropShadow dx="0" dy="2" stdDeviation="3" floodOpacity="0.2" />
          </filter>
        </defs>
        
        {/* Map background */}
        <rect x="0" y="0" width="960" height="600" fill="url(#mapBg)" rx="12" />
        
        {/* State paths */}
        {Object.entries(statePaths).map(([stateCode, { d, name }]) => {
          if (!d || d === "M0 0z") return null;
          
          const stateData = stateScores?.find(s => s.abbr === stateCode);
          const score = stateData?.score || 0;
          const isHovered = hoveredState === stateCode;
          const fillColor = score > 0 ? getScoreColor(score) : "hsl(215, 20%, 80%)";
          
          return (
            <path
              key={stateCode}
              d={d}
              fill={fillColor}
              stroke="hsl(0, 0%, 100%)"
              strokeWidth={isHovered ? "2" : "1"}
              strokeLinejoin="round"
              className="cursor-pointer transition-all duration-150"
              style={{
                filter: isHovered ? "url(#stateHover)" : "url(#stateShadow)",
                opacity: isHovered ? 1 : 0.9,
              }}
              onMouseEnter={() => setHoveredState(stateCode)}
              onMouseLeave={() => setHoveredState(null)}
              onClick={() => handleStateClick(stateCode)}
            />
          );
        })}
      </svg>
      
      {/* Tooltip */}
      {hoveredState && stateScores && (
        <div 
          className="absolute pointer-events-none z-10 bg-card border border-border rounded-lg shadow-xl px-4 py-3 text-sm"
          style={{
            left: '50%',
            top: '16px',
            transform: 'translateX(-50%)',
          }}
        >
          <div className="font-semibold text-foreground">
            {statePaths[hoveredState]?.name || hoveredState}
          </div>
          <div className="text-muted-foreground mt-1">
            {(() => {
              const stateData = stateScores.find(s => s.abbr === hoveredState);
              if (stateData && stateData.score > 0) {
                return (
                  <div className="flex items-center gap-2">
                    <span>Avg Score:</span>
                    <span 
                      className="font-bold"
                      style={{ color: getScoreColor(stateData.score) }}
                    >
                      {stateData.score}
                    </span>
                    <span className="text-xs text-muted-foreground">({stateData.memberCount} members)</span>
                  </div>
                );
              }
              return "No data available";
            })()}
          </div>
        </div>
      )}
      
      {/* Legend */}
      <div className="flex justify-center gap-6 mt-6 flex-wrap">
        {[
          { color: "#22c55e", label: "80+ Excellent" },
          { color: "#84cc16", label: "70-79 Good" },
          { color: "#eab308", label: "60-69 Average" },
          { color: "#f97316", label: "50-59 Poor" },
          { color: "#ef4444", label: "<50 Needs Work" },
        ].map(({ color, label }) => (
          <div key={label} className="flex items-center gap-2 text-sm">
            <div 
              className="w-4 h-4 rounded" 
              style={{ backgroundColor: color }} 
            />
            <span className="text-muted-foreground">{label}</span>
          </div>
        ))}
      </div>
    </div>
  );
};

export default USMap;
